# OpenSVIP 结构说明：模型与框架



## OpenSVIP 模型

OpenSVIP 模型（下称“本模型”）是与 X Studio · 歌手软件相适配的数据存储模型，是其原始二进制工程文件（.svip）的完整明文表现形式，除部分用处不大的编辑器状态记忆字段以外，与原始工程文件信息量相等。

本模型对象与 JSON 对象完全对应。以下将自顶向下对其结构进行介绍。

### 工程

工程（工程文件）是整个模型的顶层。

|   Python 类名   |         C# 类名          |
|:-------------:|:----------------------:|
| OpenSvipModel | OpenSvip.Model.Project |

|        属性名        | Python / C# 数据类型 |  泛型  | JSON 数据类型 |                    含义                    |
|:-----------------:|:----------------:|:----:|:---------:|:----------------------------------------:|
|      Version      |   str / string   |      |  string   | SVIP 工程文件版本，为 9 位固定长度字符串，例如 “SVIP7.0.0”。 |
|   SongTempoList   |   list / List    | 曲速标记 |   array   |                 曲速标记列表。                  |
| TimeSignatureList |   list / List    | 拍号标记 |   array   |                 拍号标记列表。                  |
|     TrackList     |   list / List    |  音轨  |   array   |             音轨列表，包括演唱轨与伴奏轨。              |

### 曲速标记

每个曲速标记均隶属于曲速轨，控制歌曲的行进速度。

|     Python 类名     |          C# 类名           |
|:-----------------:|:------------------------:|
| OpenSvipSongTempo | OpenSvip.Model.SongTempo |

|  属性名  | Python / C# 数据类型 | JSON 数据类型 |                             含义                             |
| :------: | :------------------: | :-----------: | :----------------------------------------------------------: |
| Position |      int / int       |    integer    | 曲速标签的位置。以**正式乐谱开始前的一小节**为起点，每个四分音符时值为 480。第一个曲速标记一定位于起点处。 |
|   BPM    |    float / float     |     float     |         每分钟节拍数，自本标记后歌曲将以此速度行进。         |

### 拍号标记

每个拍号标记均隶属于拍号轨，控制歌曲的节拍。

|       Python 类名       |            C# 类名             |
|:---------------------:|:----------------------------:|
| OpenSvipTimeSignature | OpenSvip.Model.TimeSignature |

|     属性名     | Python / C# 数据类型 | JSON 数据类型 |                         含义                         |
|:-----------:|:----------------:|:---------:|:--------------------------------------------------:|
|  BarIndex   |    int / int     |  integer  | 拍号标签所在的小节位置，以正式乐谱开始前的一小节为第 0 小节。第一个拍号标记一定位于第 0 小节。 |
|  Numerator  |    int / int     |  integer  |           拍号中的分子，代表每小节的拍数。取值范围为 1 ~ 255。           |
| Denominator |    int / int     |  integer  |       拍号中的分子，代表以几分音符为一拍。取值范围为 1/2/4/8/16/32。       |

### 音轨

音轨是工程文件模型中最重要的组成部分。本类是演唱轨与伴奏轨的公共父类。

|   Python 类名   |        C# 类名         |
|:-------------:|:--------------------:|
| OpenSvipTrack | OpenSvip.Model.Track |

以下属性为所有音轨对象的公共属性。

|  属性名   | Python / C# 数据类型 | JSON 数据类型 |                    含义                    |
|:------:|:----------------:|:---------:|:----------------------------------------:|
|  Type  |   str / string   |  string   | 音轨类型，演唱轨为 “Singing”，伴奏轨为 ”Instrumental”。 |
|  Mute  |   bool / bool    |  boolean  |                 音轨是否静音。                  |
|  Solo  |   bool / bool    |  boolean  |                 音轨是否独奏。                  |
| Volume |  float / double  |   float   |         音轨输出音量，取值范围为 0.0 ~ 2.0。          |
|  Pan   |  float / double  |   float   |         音轨输出声像，取值范围为 -1.0 ~ 1.0。         |

### 演唱轨

演唱轨包含歌手、曲谱、参数等各类信息。本类是音轨类的子类。

|      Python 类名       |            C# 类名            |
|:--------------------:|:---------------------------:|
| OpenSvipSingingTrack | OpenSvip.Model.SingingTrack |

演唱轨除具有音轨公共属性外，还具有以下属性。

|    属性名    |  Python / C# 数据类型   | 泛型 | JSON 数据类型 |                             含义                             |
| :----------: | :---------------------: | :--: | :-----------: | :----------------------------------------------------------: |
| AISingerName |      str / string       |      |    string     | 歌手名字。由于原始工程文件中歌手名字采用代号存储（例如 “F10”、“M13”），因此可能存在已拥有代号但名称未知或未公开的歌手，例如内测歌手。此种情况下本属性将以 “$(ID)” 格式存储，其中 ID 为歌手代号。 |
| ReverbPreset |      str / string       |      |    string     |      混响预设，例如 “汽水”、“浮光”。“干声” 代表无混响。      |
|   NoteList   |       list / List       | 音符 |     array     |                本音轨上的所有音符组成的列表。                |
| EditedParams | OpenSvipParams / Params |      |    object     | 本音轨上所有被编辑过的曲线型参数。注意：与原始工程文件相同，本模型仅存储已编辑过的参数部分。其中，音高参数的默认值由云端动态生成，其余参数的默认值为 0。 |

### 伴奏轨

伴奏轨包含伴奏信息。本类是音轨类的子类。

|         Python 类名         |              C# 类名               |
|:-------------------------:|:--------------------------------:|
| OpenSvipInstrumentalTrack | OpenSvip.Model.InstrumentalTrack |

伴奏轨除具有音轨公共属性外，还具有以下属性。

|      属性名      | Python / C# 数据类型 | JSON 数据类型 |                                  含义                                  |
|:-------------:|:----------------:|:---------:|:--------------------------------------------------------------------:|
| AudioFilePath |   str / string   |  string   | 伴奏音频存放路径，分隔符为 Windows 反斜杠（'\\'）格式。若对应路径不存在，则将在工程文件同级目录下寻找对应文件名的音频文件。 |
|    Offset     |    int / int     |  integer  |      伴奏音频经过移动后相对于原位置（伴奏开头与曲谱开头对齐）的偏移量，以四分音符时值为 480，正值为向后，负值为向前。      |

### 音符

音符组成曲谱与歌词，并包含音素与颤音信息。

|  Python 类名   |        C# 类名        |
|:------------:|:-------------------:|
| OpenSvipNote | OpenSvip.Model.Note |

伴奏轨除具有音轨公共属性外，还具有以下属性。

|    属性名     |   Python / C# 数据类型    | JSON 数据类型 |                             含义                             |
| :-----------: | :-----------------------: | :-----------: | :----------------------------------------------------------: |
|   StartPos    |         int / int         |    integer    | 音符起始位置。以正式乐谱开始的位置为起点（**比曲速标记和参数点的起点靠后一小节**），四分音符时值为 480。 |
|    Length     |         int / int         |    integer    |               音符长度。以四分音符时值为 480。               |
|   KeyNumber   |         int / int         |    integer    |            音符的 MIDI 编号。C-1 为 0，C4 为 60。            |
|    HeadTag    |       str / string        | string / null |      音符唱法标记。"0" 为停顿，"V" 为换气，null 为无。       |
|     Lyric     |       str / string        |    string     |            该音符上的歌词。"-" 代表转音（连音）。            |
| Pronunciation |       str / string        | string / null | 该音符的指定发音。此属性不为 null 时，实际按照该指定发音演唱。 |
| EditedPhones  |  OpenSvipPhones / Phones  | object / null | 该音符上编辑过的音素参数。默认音素参数值由云端动态生成，不进行存储；若未编辑过或本音符为转音（其音素参数由其主音符控制），此属性为 null。 |
|    Vibrato    | OpenSvipVibrato / Vibrato | object / null |       该音符上的颤音信息。若未添加过，此属性为 null。        |

### 音素

音素信息以音符为单位存储，控制每个音符（事实上是每个字）的不同部分音素长短。

|   Python 类名    |         C# 类名         |
|:--------------:|:---------------------:|
| OpenSvipPhones | OpenSvip.Model.Phones |

|       属性名        | Python / C# 数据类型 | JSON 数据类型 |                             含义                              |
|:----------------:|:----------------:|:---------:|:-----------------------------------------------------------:|
| HeadLengthInSecs |  float / float   |   float   |     对应第一根音素拉杆，表示头部音素（通常是辅音音素）的绝对长度，单位为秒。若没有修改过，值为 -1.0。     |
| MidRatioOverTail |  float / float   |   float   | 对应第二根音素拉杆，表示中部音素（通常是韵头和韵腹）与尾部音素（通常是韵尾）的长度比值。若没有修改过，值为 -1.0。 |

### 颤音

此处的颤音指颤音编辑模式下添加的颤音数据。在 X Studio · 歌手中，通过颤音编辑器添加的颤音会立即转换成音高数据并写入音高曲线。也就是说，音符中的颤音信息是完全冗余的，它的作用仅仅是保存编辑状态，以便下一次打开颤音编辑器时可以恢复。**这也是本模型存储的唯一一个编辑器状态参数，且可能在未来的模型更新中被移除。请注意：X Studio · 歌手仅依靠音高曲线信息控制音高变化，修改模型中的颤音信息并不会对演唱时的音高产生任何直接影响。**

|    Python 类名    |         C# 类名          |
|:---------------:|:----------------------:|
| OpenSvipVibrato | OpenSvip.Model.Vibrato |

|     属性名      |        Python / C# 数据类型         | JSON 数据类型 |                                                              含义                                                              |
|:------------:|:-------------------------------:|:---------:|:----------------------------------------------------------------------------------------------------------------------------:|
| StartPercent |          float / float          |   float   |                                                       颤音开始处在音符内的百分比位置。                                                       |
|  EndPercent  |          float / float          |   float   |                                                       颤音结束处在音符内的百分比位置。                                                       |
| IsAntiPhase  |           bool / bool           |  boolean  |                                                      音高抖动是否反相。默认先向下偏移。                                                       |
|  Amplitude   | OpenSvipParamCurve / ParamCurve |  object   |  颤音范围内的音高振幅包络线信息。横坐标为时值百分比，纵坐标为相对振幅值；任意锚点 (x, y) 满足 -1 &le; x &le;100001, 0 &le; y &le; 10000；两端点默认为 (-1, 0) 和 (100001, 0)。  |
|  Frequency   | OpenSvipParamCurve / ParamCurve |  object   | 颤音范围内的音高振动频率包络线信息。横坐标为时值百分比，纵坐标为相对频率值。任意锚点 (x, y) 满足 -1 &le; x &le;100001, 0 &le; y &le; 10000；两端点固定为 (-1, 0) 和 (100001, 0)。 |

### 参数

参数指在参数编辑模式下能够使用手绘工具或锚点工具绘制的曲线参数，每种参数的曲线由若干个锚点组成。**锚点的具体格式与含义见下文 “参数曲线”；除此以外仅作特殊情况的说明。**

|   Python 类名    |         C# 类名         |
|:--------------:|:---------------------:|
| OpenSvipParams | OpenSvip.Model.Params |

|  属性名  |      Python / C# 数据类型       | JSON 数据类型 |                             含义                             |
| :------: | :-----------------------------: | :-----------: | :----------------------------------------------------------: |
|  Pitch   | OpenSvipParamCurve / ParamCurve |    object     | 音高参数信息。参数值为音高对应的 MIDI 编号乘以 100，单位为音分。间断参数值为 -100。 |
|  Volume  | OpenSvipParamCurve / ParamCurve |    object     |                 音量参数信息，代表响度包络。                 |
|  Breath  | OpenSvipParamCurve / ParamCurve |    object     |             气声参数信息，代表气流成分响度包络。             |
|  Gender  | OpenSvipParamCurve / ParamCurve |    object     |       性别参数信息，代表共振峰偏移，向上为正（女性）。       |
| Strength | OpenSvipParamCurve / ParamCurve |    object     |                        力度参数信息。                        |

### 参数曲线

参数曲线包含若干锚点，每个锚点由两个整数坐标构成。锚点分为正常点与间断点。正常点的纵坐标即表示参数值，间断点的纵坐标则固定。每段被编辑过的参数曲线的第一个正常点的前面和最后一个正常点的后面均（至少）有一个横坐标与该点重合、纵坐标为间断值的间断点。任意间断点与其前后的点之间的所有部分采用默认（无参）参数值。除间断点外，相邻两个锚点之间采用直线连接。

除特殊说明外，锚点的横坐标均表示其时值位置（与**曲速**位置规则相同），范围为 -192000 ~ 1073741823；纵坐标均表示参数值，范围为 -1000 ~ 1000，对应软件中的 -1.00 ~ 1.00；中断值均为 0，代表从这一个锚点到下一个锚点之间的部分采用默认参数值；两端点横坐标分别固定为 -192000 和 1073741823（若删去或修改，则转换时将进行补回），纵坐标默认与间断值相同且允许修改。

|     Python 类名      |           C# 类名           |
|:------------------:|:-------------------------:|
| OpenSvipParamCurve | OpenSvip.Model.ParamCurve |

|       属性名        |        Python / C# 数据类型         | JSON 数据类型 |               含义               |
|:----------------:|:-------------------------------:|:---------:|:------------------------------:|
| TotalPointsCount |            int / int            |  integer  | 锚点总个数。这是一个只读属性，对其进行修改不会产生任何效果。 |
|    PointList     | List[tuple] / List&lt;Tuple&gt; | 2-d array |             锚点列表。              |



## OpenSVIP 框架

OpenSVIP 框架（以下简称“本框架”）是基于 OpenSVIP 模型的插件式工程文件转换框架。